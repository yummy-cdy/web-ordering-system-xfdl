<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="frmStaff1210" width="1600" height="900" titletext="사이렌 오더(진행 화면)" onload="frmStaff1210_onload" background="white" ontimer="frmStaff1210_ontimer">
    <Layouts>
      <Layout height="900" mobileorientation="landscape" width="1600">
        <Static id="Static01_00_00_00_00" taborder="0" text="FRAME" left="0" top="0" width="250" background="red" opacity="20%" textAlign="center" visible="false" bottom="0"/>
        <Static id="Static01_00_01_00" taborder="1" text="FRAME" left="0" top="880" height="20" background="red" opacity="20%" textAlign="center" visible="false" right="0"/>
        <Static id="Static01_00_00_00" taborder="2" text="FRAME" left="1350" top="0" width="250" background="red" opacity="20%" textAlign="center" visible="false" bottom="0"/>
        <Static id="Static01_00_01" taborder="3" text="FRAME" left="0" top="0" height="20" background="red" opacity="20%" textAlign="center" visible="false" right="0"/>
        <Grid id="grdOrderList" taborder="4" left="1630" top="18" width="1100" height="492" binddataset="ds_orderList" autofittype="col" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="ORDER_ID"/>
                <Cell col="1" text="NAME"/>
                <Cell col="2" text="PRODUCT_NAME"/>
                <Cell col="3" text="COUNT"/>
                <Cell col="4" text="STATUS_TYPE"/>
                <Cell col="5" text="ORDERED_AT"/>
              </Band>
              <Band id="body">
                <Cell text="bind:ORDER_ID" suppress="1"/>
                <Cell col="1" text="bind:NAME" suppress="1"/>
                <Cell col="2" text="bind:PRODUCT_NAME"/>
                <Cell col="3" text="bind:COUNT"/>
                <Cell col="4" text="bind:STATUS_TYPE" displaytype="combocontrol" edittype="combo" combodataset="ds_display" combocodecol="STATUS_TYPE" combodatacol="STATUS_TEXT"/>
                <Cell col="5" text="bind:ORDERED_AT" suppress="1"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="staTitle" taborder="5" text="현재 진행 중인 주문" left="250" top="120" width="805" height="80" font="normal 600 21pt/normal &quot;KopubWorld&quot;"/>
        <Static id="staStore" taborder="6" text="STORE_NAME 점" left="250" top="84" width="301" height="56" font="normal 600 13px/normal &quot;KopubWorld&quot;" color="#01a862"/>
        <TextArea id="taLog" taborder="7" left="-287" top="180" width="247" height="79" visible="true"/>
        <Div id="divBackTo" taborder="8" text="Div00" left="250" top="20" width="269" height="74">
          <Layouts>
            <Layout>
              <Button id="btnBackToMenu" taborder="0" left="0" top="17" width="40" height="40" background="url('imagerc::left.png') no-repeat center center /contain" border="0px none" onclick="divBackTo_btnBackToMenu_onclick"/>
              <Static id="staDesc" taborder="1" text="메뉴 화면" left="57" top="19" width="145" height="36" font="normal 600 15px/normal &quot;KopubWorld&quot;"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="btn00" taborder="9" text="btn00" left="1261" top="34" width="64" height="60" onclick="btn00_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <XPush id="XPush00" onerror="XPush00_onerror" onkeepalive="XPush00_onkeepalive" onsuccess="XPush00_onsuccess"/>
      <Dataset id="dsTopic">
        <ColumnInfo>
          <Column id="Chk" type="STRING" size="256"/>
          <Column id="TOPIC_ID" type="STRING" size="256"/>
          <Column id="TOPIC_NAME" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="TOPIC_ID">ALL</Col>
            <Col id="TOPIC_NAME">전체</Col>
          </Row>
          <Row>
            <Col id="TOPIC_ID">TOBEEDU01</Col>
            <Col id="TOPIC_NAME">EDU01</Col>
          </Row>
          <Row>
            <Col id="TOPIC_ID">TOBEEDU02</Col>
            <Col id="TOPIC_NAME">EDU02</Col>
          </Row>
          <Row>
            <Col id="TOPIC_ID">TOBEEDU03</Col>
            <Col id="TOPIC_NAME">EDU03</Col>
          </Row>
          <Row>
            <Col id="TOPIC_ID">TOBEEDU04</Col>
            <Col id="TOPIC_NAME">EDU04</Col>
          </Row>
          <Row>
            <Col id="TOPIC_ID">TOBEEDU05</Col>
            <Col id="TOPIC_NAME">EDU05</Col>
          </Row>
          <Row>
            <Col id="TOPIC_ID">TOBEEDU06</Col>
            <Col id="TOPIC_NAME">EDU06</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="dsMessage" onrowposchanged="dsMessage_onrowposchanged">
        <ColumnInfo>
          <Column id="TOPIC_ID" type="STRING" size="256"/>
          <Column id="TOPIC_TYPE" type="STRING" size="256"/>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="MSG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsProvider">
        <ColumnInfo>
          <Column id="PROJECT_ID" type="STRING" size="256"/>
          <Column id="PUSH_TYPE" type="STRING" size="256"/>
          <Column id="TOPIC_TYPE" type="STRING" size="256"/>
          <Column id="TOPIC_ID" type="STRING" size="256"/>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="MSG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_orderList">
        <ColumnInfo>
          <Column id="ORDER_ID" type="STRING" size="256"/>
          <Column id="LOGIN_EMAIL" type="STRING" size="256"/>
          <Column id="NAME" type="STRING" size="256"/>
          <Column id="PRODUCT_NAME" type="STRING" size="256"/>
          <Column id="COUNT" type="INT" size="256"/>
          <Column id="STATUS_TYPE" type="INT" size="256"/>
          <Column id="ORDERED_AT" type="DATETIME" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="ORDER_ID">1</Col>
            <Col id="LOGIN_EMAIL">1</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_display">
        <ColumnInfo>
          <Column id="STATUS_TYPE" type="INT" size="256"/>
          <Column id="STATUS_TEXT" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="STATUS_TYPE">0</Col>
            <Col id="STATUS_TEXT">주문 수락 대기 중</Col>
          </Row>
          <Row>
            <Col id="STATUS_TYPE">1</Col>
            <Col id="STATUS_TEXT">주문 확인</Col>
          </Row>
          <Row>
            <Col id="STATUS_TYPE">2</Col>
            <Col id="STATUS_TEXT">제조 중</Col>
          </Row>
          <Row>
            <Col id="STATUS_TYPE">4</Col>
            <Col id="STATUS_TEXT">제조 완료</Col>
          </Row>
          <Row>
            <Col id="STATUS_TYPE">8</Col>
            <Col id="STATUS_TEXT">픽업 완료</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_sendPush">
        <ColumnInfo>
          <Column id="TARGET_ID" type="STRING" size="256"/>
          <Column id="ORDER_ID" type="STRING" size="256"/>
          <Column id="STATUS" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript5.1"><![CDATA[/**
*  Nexacro Professional Training Couse
*  @MenuPath    개발가이드 > 표준 및 기본 정의 > 그리드 페이징
*  @FileName 	SamplePaging.xfdl 
*  @Creator 	TOBESOFT Education
*  @CreateDate 	2025/01/03
*  @Desction    
************** 소스 수정 이력 ***********************************************
*  date          		Modifier                Description
*******************************************************************************
*  2026/02/12      		 이아인	 	  	       최초 생성 
*******************************************************************************
*/



/************************************************************************************************
 * FORM 변수 선언 영역
 ************************************************************************************************/
this.fvApp = nexacro.getApplication();

this.strStoreName = "";

var strTopicID = this.fvApp.gdsAuth.getColumn(0, "STORE_CODE");
var strPushType = "PUSH";

/************************************************************************************************
 * FORM EVENT 영역(onload, onbeforeclose)
 ************************************************************************************************/
/**
 * @description example: ~하는 부분
*/
this.frmStaff1210_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{

	// 현재의 onload 주석 처리 -> push 혹은 timer 관련
    this.dsTopic.clearData();
	
    //var nRow = this.dsTopic.addRow();
    //this.dsTopic.setColumn(nRow, "TOPIC_ID", strTopicID);
    //this.dsTopic.setColumn(nRow, "TOPIC_NAME", "매장주문알림");

	this.setStoreName();

    this.fnXPushStart(); 
    this.fnGetOrderList();
	
	//this.setTimer(2, 5000); 
};

/************************************************************************************************
 * CALLBACK 콜백 처리부분(Transaction, Popup)
 ************************************************************************************************/
this.fn_callback = function(svcId, errCd, errMsg)
{
	if(errCd < 0){ alert("에러 : " + errMsg); }
	
	trace("svcId>>>>>>>>>"+svcId);
	
	if(svcId === "svcSendPush"){
		if(errCd >= 0){ trace("메시지를 정상적으로 발송하였습니다.");}
		else { trace("메시지 전달실패 : " + errMsg);}
		// this.reload();
	}
	
	if(svcId == "svcGetStoreName"){
		this.staStore.text = this.strStoreName+" 점";
		this.staStore.fittocontents = "width";
	}
	
	if(svcId == "svcGetOrderList"){
		this.setProdList();
	}
	
	if(svcId == "svcUpdateStatus") {
		this.fnSendPushStatus();
    }
	
	if(svcId =="svcClearOrder"){
		this.reload();
	}
}

this.fn_push_callback = function(Row, ChangeColumn, AllColumns, Type, ActionType, MessageId)
{		
	trace("!!!!!!!staff>>pushcallback");
    if(ActionType == "PUSH") {
        // 새 주문 신호(MSG가 "1")가 오면 목록 갱신
        var msg = nexacro.getApplication().gdsXPushMessage.getColumn(Row, "MSG");
        if(msg == "1") {
            this.fnGetOrderList(); 
        }
    }
};


/************************************************************************************************
 * CRUD 및 TRANSACTION 서비스 호출 처리
 ************************************************************************************************/
this.fnGetOrderList = function ()
{
	var sSvcId  = "svcGetOrderList";
	var sUrl    = "p024/getOrderList.do";
	var inData  = "";
	var outData = "ds_orderList=out_data";
	var sParam  = "strTopicId="+strTopicID;
	this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fn_callback");
};

this.fnGetStoreName = function ()
{
	var sSvcId  = "svcGetStoreName";
	var sUrl    = "p024/getStoreName.do";
	var inData  = "";
	var outData = "";
	var sParam  = "storeCode="+strTopicID;
	this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fn_callback");
};

/************************************************************************************************
 * 사용자 FUNCTION 영역
 ************************************************************************************************/
this.setStoreName = function ()
{
	this.fnGetStoreName();
};

this.frmCust1210_ontimer = function(obj:nexacro.Form,e:nexacro.TimerEventInfo)
{
    if (e.timerid == 2) {
        this.fnGetOrderList();
    }
};

this.makeTitle = function (objDiv, sOrderId, sUserName)
{
    // 주문 번호
	var staTitle = new Static();
    var sStaId = "staOrderTitle_" + sOrderId;
    
    // 부모 Div 내부 상단에 고정 (0, 0 위치)
    staTitle.init(sStaId, 0, 0, null, 50, 0); 
        
    staTitle.set_text(" 주문번호 : " + sOrderId);
    staTitle.set_textAlign("left");
    staTitle.set_font("normal bold 16px/normal 'KopubWorld'");
    staTitle.set_background("#f4f4f2");
    staTitle.set_padding("0px 0px 0px 10px");
    
    objDiv.form.addChild(sStaId, staTitle);
    staTitle.show();
	
	
	// 주문자명
	var staName = new Static();
    var sStaId2 = "staUserTitle_" + sOrderId;
    
    // 부모 Div 내부 상단에 고정 (0, 0 위치)
    staName.init(sStaId2, null, 0, 400, 50, 10, null); 
        
    staName.set_text(" 주문자명 : " + sUserName+" 님"); // !chk
    staName.set_textAlign("right");
    staName.set_font("normal bold 14px/normal 'KopubWorld'");
    staName.set_background("#f4f4f2");
    staName.set_padding("0px 0px 0px 10px");
    
    objDiv.form.addChild(sStaId2, staName);
    staName.show();
	
	
};

this.makeStaName = function (objDiv, objDs, i, nItemY) // 인자 순서와 개수 확인!
{
    var sId = "staProdName_" + objDs.getColumn(i, "ORDER_ID") + "_" + i;
    var staProdName = new Static();
    
    // 부모 Div 내부에서 nItemY 좌표에 배치
    staProdName.init(sId, 10, nItemY, 260, 30);
    staProdName.set_text(objDs.getColumn(i, "PRODUCT_NAME"));
    staProdName.set_font("normal bold 13px/normal 'KopubWorld'");
    staProdName.set_color("#000000"); 
    
    objDiv.form.addChild(sId, staProdName); // objDiv를 직접 사용
    staProdName.show();
};

this.makeStaCount = function (objDiv, objDs, i, nItemY)
{
    var sId = "staProdCount_" + i;
    var staCount = new Static();
    
    staCount.init(sId, 300, nItemY, 100, 30); // 좌표 겹치지 않게 조정
    var nCount = objDs.getColumn(i, "COUNT");
    staCount.set_text(nexacro.toNumber(nCount).toLocaleString() + "개");
    staCount.set_color("#ff5500");
    
    objDiv.form.addChild(sId, staCount);
    staCount.show();
};

this.makeBtnStatus = function (objDiv, i)
{
    var sId = "btnStatus_" + i;
    var btnStatus = new Button();
    
    btnStatus.init(sId, null, null, 100, 35, 20, 10); // 우측 하단 배치
    
    // 현재 데이터셋의 상태값 가져오기
    var nStatus = nexacro.toNumber(this.ds_orderList.getColumn(i, "STATUS_TYPE"));
    
    // 상태값에 따른 버튼 텍스트 정의
    if(nStatus == 0) btnStatus.set_text("주문 수락");
    else if(nStatus == 1) btnStatus.set_text("제조 시작");
    else if(nStatus == 2) btnStatus.set_text("제조 완료");
    else if(nStatus == 4) btnStatus.set_text("픽업 완료");

    btnStatus.set_background("white");
    btnStatus.set_border("1px solid black");
    
    btnStatus.identf = this.ds_orderList.getColumn(i, "LOGIN_EMAIL");
    btnStatus.status = nStatus;
    btnStatus.orderidentf = this.ds_orderList.getColumn(i, "ORDER_ID");
    
    btnStatus.addEventHandler("onclick", this.fnUpdateStatus, this);
    
    objDiv.form.addChild(sId, btnStatus);
    btnStatus.show();
};

this.setProdList = function ()
{
    this.deleteDiv(); // 기존 UI 초기화
    
    var objDs = this.ds_orderList;
    if (objDs == null || objDs.getRowCount() == 0) return;
	
	objDs.set_keystring("S:+ORDERED_AT");

    var nCardW   = 1100;
    var nGapY    = 30;
    var nStartX  = 250;
    var nTop     = 210;
    
    var sPrevOrderId = "";
    var objDiv = null;
    var nItemY = 0; // Div 내부에서 상품이 그려질 Y 좌표

    for(var i=0; i < objDs.getRowCount(); i++)
    {
        var sCurrOrderId = objDs.getColumn(i, "ORDER_ID");
		var sCurrUserName = objDs.getColumn(i, "NAME");

        // [STEP 1] 새로운 주문번호가 등장하면 큰 도화지(Div) 생성
        if (sCurrOrderId != sPrevOrderId) 
        {
            // 이전 주문의 버튼을 생성 (첫 번째 루프 제외)
            if(objDiv != null) {
                this.makeBtnStatus(objDiv, i-1);
                nTop = objDiv.getOffsetBottom() + nGapY;
            }
			
			
            var sDivId = "divCard_" + sCurrOrderId;
            objDiv = new Div();
            objDiv.init(sDivId, nStartX, nTop, nCardW, 200); 
			
            objDiv.set_border("2px solid #2d2d2d");
            objDiv.set_background("#ffffff");
			
            this.addChild(sDivId, objDiv);
            objDiv.show();

            // 주문번호 제목 생성
            this.makeTitle(objDiv, sCurrOrderId, sCurrUserName);
            
            nItemY = 60; // 타이틀 아래부터 상품 시작
            sPrevOrderId = sCurrOrderId;
        }

        // [STEP 2] 동일한 주문번호 내에서 상품들 나열
        this.makeStaName(objDiv, objDs, i, nItemY);
        this.makeStaCount(objDiv, objDs, i, nItemY);
        
        nItemY += 40; // 다음 상품을 위해 Y축 이동
        
        // Div 높이 자동 조절 (상품이 많아지면 Div도 길어지게)
        objDiv.set_height(nItemY + 60); // 버튼 들어갈 자리 확보
    }
    
    // 마지막 주문건의 버튼 생성
    if(objDiv != null) this.makeBtnStatus(objDiv, objDs.getRowCount()-1);
    
    this.resetScroll();
};


this.deleteDiv = function ()
{
    for(var i = this.components.length - 1; i >= 0; i--) // 컴포넌트 삭제 시 id 충돌 때문에 역순 삭제
    {
        var obj = this.components[i];
		if(obj instanceof nexacro.Static && obj.id.indexOf("staOrderTitle_") == 0)
        {
            this.removeChild(obj.id).destroy();
        }
        if(obj instanceof nexacro.Div && obj.id.indexOf("divCard_") == 0)
        {
            this.removeChild(obj.id).destroy();
        }
    }
};

this.deleteOneDiv = function (targetId)
{
	// targetId가 객체일 수도 있고, ID(문자열)일 수도 있으므로 체크
    var objDelete;
    if (typeof targetId == "string") {
        objDelete = this.components[targetId];
    } else {
        objDelete = targetId;
    }

    if (objDelete) {
        var sId = objDelete.id;
        this.removeChild(sId); 
        objDelete.destroy();    
        
        this.fnGetOrderList(); 
    }
	
	this.resetScroll();
};


this.fnClearOrder = function (target)
{
	//  DB(user의 isinorder를 null, storeorders delete)
	var sSvcId  = "svcClearOrder";
	var sUrl    = "p024/clearOrder.do";
	var inData  = "";
	var outData = "";
	var sParam  = "orderId="+target;
	this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fn_callback");
};

this.fnUpdateStatus = function (obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var targetIdentf = obj.identf; // LOGIN_EMAIL
	var currentStatus = nexacro.toNumber(obj.status); // STATUS TYPE
    var nextStatus;
    var orderId = obj.orderidentf; // ORDER_ID
	
	this.ds_sendPush.clearData();
	this.ds_sendPush.setColumn(0, "TARGET_ID", targetIdentf);
	this.ds_sendPush.setColumn(0, "ORDER_ID", orderId);
	this.ds_sendPush.setColumn(0, "STATUS", nextStatus);
	
	switch(currentStatus) {
	case 0:
		nextStatus = 1;
		break;
	case 1:
		nextStatus = 2;
		break;
	case 2:
		nextStatus = 4;
		break;
	case 4:
		nextStatus = 8;
		this.deleteOneDiv(obj.parent.parent) // 해당 주문을 화면에서 삭제
		this.fnClearOrder(orderId); // DB(user의 isinorder를 null, storeorders delete)
		return;
	default:
		return;
	}

    // 1. 먼저 DB 업데이트
	var sSvcId  = "svcUpdateStatus";
    var sUrl    = "p024/updateStatus.do"; 
    var inData  = ""; 
    var outData = "";
    var sParam  = "orderId=" + orderId + " nextStatus=" + nextStatus;
    this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fn_callback");
	// callback에서 push를 쏴준다. 
};	

this.fnSendPushStatus = function ()
{
	var targetIdentf = this.ds_sendPush.getColumn(0, "TARGET_ID");
	var orderId = this.ds_sendPush.getColumn(0, "ORDER_ID");
	var nextStatus = this.ds_sendPush.getColumn(0, "STATUS");
	
	trace(">>>>> ds_sendPush>>>"+targetIdentf+" 덧 "+orderId+" 덧 "+nextStatus);
	
	// 2. push 
    this.dsProvider.clearData();
    var pRow = this.dsProvider.addRow();
    this.dsProvider.setColumn(pRow, "PROJECT_ID", "TOBE_EDU");
    this.dsProvider.setColumn(pRow, "PUSH_TYPE", "PUSH");
    this.dsProvider.setColumn(pRow, "TOPIC_TYPE", "9999");
    this.dsProvider.setColumn(pRow, "TOPIC_ID", targetIdentf); // 고객 ID
    this.dsProvider.setColumn(pRow, "CODE", orderId);          // 주문 번호
    this.dsProvider.setColumn(pRow, "MSG", nextStatus);        // 바뀐 상태값

    var sPushSvcId = "svcSendPush";
    var sPushUrl   = "SvcXpushUrl::Service_XPush.jsp"; 
    var sPushInDs  = "in_Provider=dsProvider:U";
    var sPushArg   = "argPUSH_TYPE=" + nexacro.wrapQuote("PUSH") 
                   + " argPUSH_MSG=" + nexacro.wrapQuote(nextStatus);
    
	trace(this.dsProvider.saveXML());
	trace("push this.trans 직전");
    this.transaction(sPushSvcId, sPushUrl, sPushInDs, "", sPushArg, "fn_callback"); // !260225
};

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역
 ************************************************************************************************/
this.divBackTo_btnBackToMenu_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fvApp.mainframe.WorkFrame.formurl = "Staff::frmStaff1200.xfdl";
};

/************************************************************************************************
 * XPush 처리 영역
 ************************************************************************************************/
// @cate push
this.fnXPushStart = function ()
{

	if ((nexacro._OS == "Android" || nexacro._OS == "iOS") && (nexacro._Browser == "Runtime"))  
	{      
		this.XPush00.set_layouturl("%USERAPP%XPushUrl/XPush_Message_Layout.xml");
	} else   
	{    
		this.XPush00.set_layouturl("XPushUrl::XPush_Message_Layout.xml");
	}   
	
//Connection 
   this.XPush00.set_projectid("TOBE_EDU");
   this.XPush00.set_protocolversion(3);
   
   this.XPush00.set_iplist("tcp://localhost:50001, http://localhost:50000, http://172.10.14.128:50000");
   
   
// 	
//     this.XPush00.set_projectid("TOBE_EDU");
//     // 사용 가능한 모든 프로토콜/IP 리스트 세팅
//     this.XPush00.set_iplist("tcp://localhost:50001, http://localhost:50000, http://172.10.14.128:50000");
    
    // 매장 코드를 ID 삼아 접속
    this.XPush00.connect(strTopicID, "..."); 
	
	   
};
this.XPush00_onsuccess = function(obj:nexacro.XPush,e:nexacro.XPushEventInfo)
{
trace("onsuccesss===" + e.action); 
    if(e.action == 0) { // Connect 성공
		this.XPush00.subscribe("9999", strTopicID, this, nexacro.getApplication().gdsXPushMessage, "append", "fn_push_callback");
    }
    if(e.action == 2) this.XPush00.registerTopic("9999", strTopicID);
};
this.dsMessage_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	if(obj.rowcount > 0){
        var msg = obj.getColumn(e.newrow, "MSG");
        if(msg == "1") { // 새 주문
            this.fnGetOrderList();
        }
    }
};

this.btn00_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.reload();
};

this.frmStaff1210_ontimer = function(obj:nexacro.Form,e:nexacro.TimerEventInfo)
{
	
};
]]></Script>
    <Bind>
      <BindItem id="item0" compid="grdOrderList" propid="binddataset" datasetid="ds_orderList" columnid=""/>
    </Bind>
  </Form>
</FDL>
