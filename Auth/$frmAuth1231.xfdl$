<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="frmAuth1230" width="1600" height="770" titletext="회원가입(고객)" background="white" onload="frmAuth1230_onload">
    <Layouts>
      <Layout height="770" mobileorientation="landscape" width="1600">
        <Static id="Static01_00_00_00_00" taborder="0" text="FRAME" left="0" top="0" width="250" background="red" opacity="40%" textAlign="center" visible="false" bottom="0"/>
        <Static id="Static01_00_00_00" taborder="1" text="FRAME" left="1350" top="0" width="250" background="red" opacity="40%" textAlign="center" visible="false" bottom="0"/>
        <Static id="Static01_00_01" taborder="2" text="FRAME" left="0" top="0" height="20" background="red" opacity="40%" textAlign="center" visible="false" right="0"/>
        <Static id="Static01_00_01_00" taborder="3" text="FRAME" left="0" top="750" height="20" background="red" opacity="40%" textAlign="center" visible="false" right="0"/>
        <Div id="divSignUp" taborder="4" text="Div00" left="15.63%" top="2.2222222222222223%" width="68.75%" formscrollbarsize="0" bottom="2.2222222222222223%">
          <Layouts>
            <Layout>
              <TextField id="tfEmail" taborder="0" labeltext="ID (Email)" left="31.00%" top="25.01%" width="28.09090909090909%" height="7.746904258532165%" font="normal bold 13px/normal &quot;KopubWorld&quot;normal bold 13px/normal &quot;KopubWorld&quot;" inputtype="email" oninput="divSignUp_tfEmail_oninput"/>
              <TextField id="tfPW" taborder="1" labeltext="Password" left="31.00%" top="32.75%" width="37.36363636363637%" height="7.746904258532165%" font="normal bold 13px/normal &quot;KopubWorld&quot;normal bold 13px/normal &quot;KopubWorld&quot;" onchanged="divSignUp_tfPW_onchanged" inputtype="password"/>
              <ImageViewer id="staLogo" taborder="2" left="342" top="8.02%" width="37.36363636363637%" height="11.627906976744185%" border="0px none" background="url('imagerc::starbucks-seeklogo.png') no-repeat left center /contain" text=""/>
              <TextField id="tfPWChk" taborder="3" labeltext="Password Check" left="31.00%" top="42.00%" width="37.36363636363637%" height="7.746904258532165%" font="normal bold 13px/normal &quot;KopubWorld&quot;normal bold 13px/normal &quot;KopubWorld&quot;" inputtype="password" canchange="divSignUp_tfPWChk_canchange"/>
              <TextField id="tfName" taborder="4" labeltext="Name" left="31.00%" top="51.24%" width="37.36363636363637%" height="7.610993657505285%" font="normal bold 13px/normal &quot;KopubWorld&quot;normal bold 13px/normal &quot;KopubWorld&quot;"/>
              <Button id="btnSignUp" taborder="5" text="회원가입" left="31.00%" top="61.30%" width="37.36363636363637%" height="3.8054968287526423%" onclick="divSignUp_btnSignUp_onclick" enable="true" font="normal bold 13px/normal &quot;KopubWorld&quot;" borderRadius="5px 5px 5px 5px" border="1px solid #000000" background="white"/>
              <Button id="btnValidEmail" taborder="6" left="60.00%" top="26.77%" width="8%" height="5.844155844155844%" onclick="divSignUp_btnValidEmail_onclick" font="normal bold 13px/normal &quot;KopubWorld&quot;" border="1px solid black" text="중복 체크" background="white" borderRadius="5px 5px 5px 5px"/>
            </Layout>
          </Layouts>
        </Div>
        <Grid id="Grid00" taborder="5" left="1840" top="330" width="313" height="228" binddataset="ds_signUp" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
              </Columns>
              <Rows>
                <Row band="head" size="24"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="LOGIN_EMAIL"/>
                <Cell col="1" text="LOGIN_PW"/>
                <Cell col="2" text="CHECK_PW"/>
                <Cell col="3" text="NAME"/>
              </Band>
              <Band id="body">
                <Cell text="bind:LOGIN_EMAIL"/>
                <Cell col="1" text="bind:LOGIN_PW"/>
                <Cell col="2" text="bind:CHECK_PW"/>
                <Cell col="3" text="bind:NAME"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btnNaverSignUp" taborder="6" left="37.19%" top="105.06%" width="25.6875%" height="5.454545454545454%" font="normal bold 13px/normal &quot;KopubWorld&quot;" border="0px none" background="url('imagerc::NAVER_signup_Light_KR_green_wide_H56.png') no-repeat center center /contain" visible="false"/>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[/**
*  Nexacro Professional Training Couse
*  @MenuPath    개발가이드 > 표준 및 기본 정의 > 그리드 페이징
*  @FileName 	SamplePaging.xfdl 
*  @Creator 	TOBESOFT Education
*  @CreateDate 	2025/01/03
*  @Desction    
************** 소스 수정 이력 ***********************************************
*  date          		Modifier                Description
*******************************************************************************
*  2026/01/27      		 이아인	 	  	       최초 생성, DB 연결 성공 
*******************************************************************************
*  2026/01/29      		 이아인	 	  	       정합성(정규 표현식) 체크 완료
*******************************************************************************
*/



/************************************************************************************************
 * FORM 변수 선언 영역
 ************************************************************************************************/
this.bValidEmail = false;

/************************************************************************************************
 * FORM EVENT 영역(onload, onbeforeclose)
 ************************************************************************************************/
/**
 * @description example: ~하는 부분
*/
this.frmAuth1230_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{
	this.ds_signUp.addRow();
};

/************************************************************************************************
 * CALLBACK 콜백 처리부분(Transaction, Popup)
 ************************************************************************************************/
this.fn_callback = function(svcId, errCd, errMsg)
{
	if(errCd < 0){
		alert("에러 : " + errMsg);
		return;
	}
	var sMsgId = "";
	
	if(svcId == "svcRegisterUser"){
		if(errCd>=0){
			this.sleep(500);
			this.parent.parent.divCenter.url = "Auth::frmAuth1200.xfdl";
		}
		else
			this.gfnAlert("msg.action.fail");		// 저장에 실패하였습니다.			
	}
	
	if(svcId == "svcIsValidEmail"){
		if(this.bValidEmail==true){
			this.fnItIsValidEmail();
		}
		else{
			//alert("false>>"+this.bValidEmail);
			alert("이미 사용 중인 이메일입니다");
		}
	}
	
	
}

/************************************************************************************************
 * CRUD 및 TRANSACTION 서비스 호출 처리
 ************************************************************************************************/


/************************************************************************************************
 * 사용자 FUNCTION 영역
 ************************************************************************************************/

this.fnCheckIsBlankIn = function (purpose)
{
	var regex = /\s/; 
    var arrCheckCols = []; // 검사할 컬럼 ID들을 담을 배열

    // 1. 체크 범위 설정
    if(purpose == "isValidEmail") {
        arrCheckCols.push("LOGIN_EMAIL"); // 이메일 체크 시에는 이메일 컬럼만
    }
	else {
        // 전체 가입 버튼 클릭 시에는 상태값 제외 전체 컬럼
        for(var i=0; i<this.ds_signUp.colcount; i++){
            var colId = this.ds_signUp.getColID(i);
            if(colId != "IS_VALID_EMAIL"){
                arrCheckCols.push(colId);
            }
        }
    }

    // 2. 설정된 컬럼들만 정밀 검사
    for(var i=0; i<arrCheckCols.length; i++){
        var sColId = arrCheckCols[i];
        var sVal = this.ds_signUp.getColumn(0, sColId);
        
        if(this.gfnIsNull(sVal)){ 
            return false; 
        }
        
        if(regex.test(sVal.toString())){ // 공백이 나온다면
            return false; 
        }
    }
    return true; 
};

this.fnCheckValidation = function ()
{
	var isBlank = this.fnCheckIsBlankIn();
	if(!isBlank){
		alert("공백은 포함할 수 없습니다");
		return false;
	}
	
	this.gfnClearValidation(this.ds_signUp);
	
	this.gfnSetValidation(this.ds_signUp, "LOGIN_EMAIL", "이메일(ID)", "required,isemail");	// 아이디 입력 체크
	this.gfnSetValidation(this.ds_signUp, "LOGIN_PW", "비밀번호", "required,rangelength:1:20");	 // 패스워드 입력 체크
	this.gfnSetValidation(this.ds_signUp, "CHECK_PW", "비밀번호 확인", "required,equalto:LOGIN_PW");	// 패스워드 일치 체크
	this.gfnSetValidation(this.ds_signUp, "NAME", "이름", "required,rangelength:1:10");	// 이름 입력 체크
	this.gfnSetValidation(this.ds_signUp, "IS_VALID_EMAIL", "이메일 중복 체크", "required");	// 이름 입력 체크
	
	// 수정된 Row가 아닌 전체 Row에 대해 Validation check, U는 수정한 Row
 	if (this.gfnValidation(this.ds_signUp, "A") == false) return false;

	return true;
}; 

this.fnItIsValidEmail = function ()
{
	this.divSignUp.form.btnValidEmail.background = "green";
	this.divSignUp.form.btnValidEmail.color = "white";
	this.ds_signUp.setColumn(0,"IS_VALID_EMAIL","Clear");
	//alert("true>>"+this.bValidEmail);
	//this.divSignUp.form.btnValidEmail.enable = false;
	//this.divSignUp.form.tfEmail.enable = false;
	alert("사용 가능한 이메일 입니다");
};

this.fn_canchange = function(obj:nexacro.TextField,e:nexacro.ChangeEventInfo)
{
	// 
};

/************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역
 ************************************************************************************************/

this.divSignUp_btnSignUp_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	
	trace("2. signup btn>>"+this.ds_signUp.getColumn(0, "IS_VALID_EMAIL"));
	// 정합성 검사
	var bChkVal = this.fnCheckValidation();
	// (이메일 양식, 중복, 패스워드 재입력 일치, 이름에 숫자 들어가진 않았는가 등)
	
	if(this.bValidEmail == false){
		alert("이메일 중복 체크는 필수입니다.");
		return;
	}
	
	if(bChkVal){
		var sSvcId  = "svcRegisterUser";
		var sUrl    = "p024/registerUser.do";
		var inData  = "ds_input=ds_signUp:u";
		var outData = "";
		var sParam  = "";
		this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fn_callback");
		
		alert("회원가입이 완료되었습니다");
	}
	
};

this.divSignUp_btnValidEmail_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var isBlank = this.fnCheckIsBlankIn("isValidEmail");
	if(!isBlank){
		alert("공백은 포함할 수 없습니다");
		return;
	}
	
	this.gfnClearValidation(this.ds_signUp);
    this.gfnSetValidation(this.ds_signUp, "LOGIN_EMAIL", "이메일(ID)", "isemail");
    // 이메일 형식에 맞지 않으면 여기서 걸러짐
    if (this.gfnValidation(this.ds_signUp, "U") == false) return;
	
	trace("1. valid email btn>>"+this.ds_signUp.getColumn(0, "IS_VALID_EMAIL"));
	
	var sSvcId  = "svcIsValidEmail";
	var sUrl    = "p024/isValidEmail.do"; 
	var inData  = "";
	var outData = "";
	var sParam  = "inputEmail=" + this.divSignUp.form.tfEmail.value;
	
	this.gfnTransaction(sSvcId, sUrl, inData, outData, sParam, "fn_callback");
};



this.ds_signUp_cancolumnchange = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	this.bValidEmail= false;
	this.divSignUp.form.btnValidEmail.background = "white";
	this.divSignUp.form.btnValidEmail.color = "black";
	this.ds_signUp.setColumn(0,"IS_VALID_EMAIL", "");
};

this.ds_signUp_canrowposchange = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	this.bValidEmail= false;
	this.divSignUp.form.btnValidEmail.background = "white";
	this.divSignUp.form.btnValidEmail.color = "black";
	this.ds_signUp.setColumn(0,"IS_VALID_EMAIL", "");
};

this.divSignUp_tfEmail_oninput = function(obj:nexacro.TextField,e:nexacro.InputEventInfo)
{
	obj.updateToDataset();
};
]]></Script>
    <Objects>
      <Dataset id="ds_signUp" cancolumnchange="ds_signUp_cancolumnchange" canrowposchange="ds_signUp_canrowposchange">
        <ColumnInfo>
          <Column id="LOGIN_EMAIL" type="STRING" size="256"/>
          <Column id="LOGIN_PW" type="STRING" size="256"/>
          <Column id="CHECK_PW" type="STRING" size="256"/>
          <Column id="NAME" type="STRING" size="256"/>
          <Column id="IS_VALID_EMAIL" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="divSignUp.form.tfEmail" propid="value" datasetid="ds_signUp" columnid="LOGIN_EMAIL"/>
      <BindItem id="item2" compid="divSignUp.form.tfName" propid="value" datasetid="ds_signUp" columnid="NAME"/>
      <BindItem id="item1" compid="divSignUp.form.tfPWChk" propid="value" datasetid="ds_signUp" columnid="CHECK_PW"/>
      <BindItem id="item3" compid="divSignUp.form.tfPW" propid="value" datasetid="ds_signUp" columnid="LOGIN_PW"/>
    </Bind>
  </Form>
</FDL>
